{% extends "accuiel/base.html" %} {# Adaptez le chemin de votre base template #}
{% load humanize %} {# Pour le formatage des nombres et dates #}

{% block content %}
<style>
    /* --- Réutilisez les styles CSS de votre fichier précédent --- */
    /* (variables :root, body, .page-container, .section-title, table.elegant-table, etc.)  */
    /* --- Vous pouvez ajouter des styles spécifiques ici si besoin --- */
     :root {
        /* Définir des couleurs primaires et secondaires (à adapter à votre thème) */
        --primary-color: #007bff; /* Bleu Bootstrap par défaut */
        --secondary-color: #6c757d; /* Gris secondaire */
        --light-gray: #f8f9fa;
        --medium-gray: #e9ecef;
        --dark-gray: #495057;
        --text-color: #343a40;
        --white: #ffffff;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --info-color: #17a2b8;
        --warning-color: #ffc107; /* Ajout couleur avertissement */
        --border-radius: 0.3rem; /* Rayon d'arrondi standard */
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Alternative moderne */
        background-color: var(--light-gray);
        color: var(--text-color);
        line-height: 1.6;
    }

    .page-container {
        margin: 30px auto;
        padding: 20px 30px;
        background-color: var(--white);
        border-radius: var(--border-radius);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.07);
        max-width: 1300px;
        overflow: hidden;
    }
    
    /* --- Conteneur pour Titre et Bouton (si besoin) --- */
    .section-header {
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 20px; 
        padding-bottom: 10px;
        border-bottom: 1px solid var(--medium-gray);
    }

    /* --- Titre de Section --- */
     h1.section-title { 
        color: var(--dark-gray);
        margin-bottom: 0; 
        padding-bottom: 0; 
        border-bottom: none; 
        font-weight: 600;
        font-size: 1.5em;
        flex-grow: 1;
        line-height: 1.3; /* Ajustement pour les titres longs */
    }
    .section-title small {
        display: block;
        font-size: 0.7em;
        color: var(--secondary-color);
        font-weight: 400;
        margin-top: 5px;
    }

    /* --- Tableau --- */
    .table-wrapper {
        overflow-x: auto;
    }

    table.elegant-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
    }

    table.elegant-table thead th {
        background-color: var(--white);
        color: var(--secondary-color);
        border-bottom: 2px solid var(--primary-color);
        padding: 14px 16px;
        text-align: left;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.8em;
        letter-spacing: 0.05em;
        position: sticky; top: 0; background-color: var(--white); z-index: 1;
    }

    table.elegant-table tbody td {
        padding: 12px 16px; /* Légèrement moins haut que l'en-tête */
        border-bottom: 1px solid var(--medium-gray);
        vertical-align: middle;
        color: var(--text-color);
        font-size: 0.90em; /* Un peu plus petit pour contenir plus d'infos */
        transition: background-color 0.15s ease-in-out;
    }

    table.elegant-table tbody tr:nth-of-type(even) td {
        background-color: var(--light-gray);
    }

    table.elegant-table tbody tr:nth-of-type(odd) td {
        background-color: var(--white);
    }

    table.elegant-table tbody tr:hover td {
        background-color: color-mix(in srgb, var(--primary-color) 10%, white);
    }
    
    /* --- Badges de Statut --- */
    .status-badge {
        font-weight: 500;
        padding: 4px 8px; /* Plus petit */
        border-radius: var(--border-radius);
        display: inline-flex;
        align-items: center;
        font-size: 0.8em; /* Plus petit */
        gap: 4px;
        text-transform: capitalize;
    }
    .status-badge.confirmé {
        color: var(--success-color);
        background-color: color-mix(in srgb, var(--success-color) 15%, transparent);
    }
    .status-badge.en-attente {
        color: var(--warning-color);
        background-color: color-mix(in srgb, var(--warning-color) 15%, transparent);
    }
    .status-badge .icon { font-size: 1em; }

     .receipt-link {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s;
    }
    .receipt-link:hover {
        color: color-mix(in srgb, var(--primary-color) 80%, black);
        text-decoration: underline;
    }
    .no-receipt {
        color: var(--secondary-color);
        font-style: italic;
        font-size: 0.9em;
    }
    
    /* --- Message si aucune donnée --- */
    .no-data {
        text-align: center;
        padding: 40px 20px;
        color: var(--secondary-color);
        font-style: italic;
        background-color: var(--light-gray);
        border-radius: var(--border-radius);
    }

    /* --- Pagination (Styles de base, adaptez si vous utilisez un framework CSS) --- */
    .pagination {
        margin-top: 20px;
        text-align: center;
    }
    .step-links {
        display: inline-block;
    }
    .step-links a, .step-links .current {
        color: var(--primary-color);
        float: left;
        padding: 8px 16px;
        text-decoration: none;
        transition: background-color .3s;
        border: 1px solid var(--medium-gray);
        margin: 0 4px;
        border-radius: var(--border-radius);
    }
    .step-links a:hover {
        background-color: var(--light-gray);
    }
    .step-links .current {
        background-color: var(--primary-color);
        color: white;
        border: 1px solid var(--primary-color);
    }
    .step-links .disabled {
        color: var(--secondary-color);
        pointer-events: none;
        border-color: var(--light-gray);
    }

</style>

<div class="page-container">

    {# --- En-tête de la section --- #}
    <div class="section-header">
        <h1 class="section-title">
            Historique des Paiements
            {% if location %}
            <small>
                Location #{{ location.id }} - Locataire: {{ location.utilisateur.get_full_name|default:'(Non défini)' }} 
                (Chambre {{ location.chambre.id|default:'N/A' }} - Maison: {{ location.chambre.maison.nom|default:'N/A' }})
                <p><strong>Locataire :</strong> {{ location.utilisateur.prenom }} {{ location.utilisateur.nom }}</p>
    <p><strong>Maison :</strong> {{ location.chambre.maison.nom }}</p>
    <p><strong>Adresse :</strong> {{ location.chambre.maison.adresse }}</p>
    <p><strong> date debut :</strong> {{ location.date_debut_location }}</p>
    <p><strong> date debut :</strong> {{ location.date_debut_location }}</p>
    <p><strong> date fin :</strong> {{ location.date_fin_location }}</p>
    <p><strong>Montant :</strong> {{ location.montant_total }} FCFA</p>
    

    <p><strong>Chambre :</strong> {{ location.chambre.type_chambre.nom }} (Surface : {{ location.chambre.surface }} m²)</p>
    <p><strong>Prix :</strong> {{ location.chambre.prix }} FCFA / mois</p>
            </small>
            {% endif %}
        </h1>
        {# --- Vous pouvez ajouter un bouton ici si nécessaire, par exemple pour ajouter un nouveau paiement --- #}
        {# <a href="{% url 'url_vers_ajout_paiement' location.id %}" class="btn btn-primary">Ajouter Paiement</a> #}
    </div>

    {% if paiements %}
        <div class="table-wrapper">
            <table class="elegant-table">
                <thead>
                    <tr>
                        <th>Date Paiement</th>
                        <th>Montant Payé</th>
                        <th>Mois Payés</th>
                        <th>Date Fin Couverte</th> {# Ajouté pour clarté si date_fin_paiement est pertinent #}
                        <th>Mode</th>
                        <th>Statut</th>
                        <th>Commission</th>
                        <th>Commentaire</th>
                        <th>Reçu</th>
                    </tr>
                </thead>
                <tbody>
                    {% for paiement in paiements %}
                        <tr>
                            <td>{{ paiement.date_paiement|date:"d/m/Y H:i" }}</td>
                            <td>{{ paiement.montant_paye|floatformat:"0"|intcomma }} FCFA</td>
                            <td>{{ paiement.nombre_mois_paye }}</td>
                            <td>{{ paiement.date_fin_paiement|date:"d/m/Y"|default:"-" }}</td>
                            <td>{{ paiement.get_mode_paiement_display }}</td>
                            <td>
                                <span class="status-badge {{ paiement.statut_paiement|lower }}">
                                    {% if paiement.statut_paiement == 'confirmé' %} <span class="icon">✅</span>
                                    {% elif paiement.statut_paiement == 'en attente' %} <span class="icon">⏳</span>
                                    {% endif %}
                                    {{ paiement.get_statut_paiement_display }}
                                </span>
                            </td>
                            <td>{{ paiement.commission|floatformat:"0"|intcomma }} FCFA</td>
                            <td>{{ paiement.commentaire|default:""|truncatewords:10 }}</td> {# Tronque les commentaires longs #}
                            <td>
                                {% if paiement.Recu_pdf %}
                                    <a href="{{ paiement.Recu_pdf.url }}" target="_blank" class="receipt-link">Voir</a>
                                {% else %}
                                    <span class="no-receipt">-</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {# --- Section Pagination (si activée dans la vue) --- #}
        {% if is_paginated %}
            <div class="pagination">
                <span class="step-links">
                    {% if page_obj.has_previous %}
                        <a href="?page=1">&laquo; Première</a>
                        <a href="?page={{ page_obj.previous_page_number }}">Précédente</a>
                    {% else %}
                         <span class="disabled">&laquo; Première</span>
                         <span class="disabled">Précédente</span>
                    {% endif %}

                    <span class="current">
                        Page {{ page_obj.number }} sur {{ page_obj.paginator.num_pages }}.
                    </span>

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}">Suivante</a>
                        <a href="?page={{ page_obj.paginator.num_pages }}">Dernière &raquo;</a>
                    {% else %}
                        <span class="disabled">Suivante</span>
                        <span class="disabled">Dernière &raquo;</span>
                    {% endif %}
                </span>
            </div>
        {% endif %}
        {# --- Fin Section Pagination --- #}

    {% else %}
         <div class="no-data">
            <p>Aucun paiement n'a été enregistré pour cette location pour le moment.</p>
            {# Optionnel: Bouton pour ajouter le premier paiement #}
             {# <a href="{% url 'url_vers_ajout_paiement' location.id %}" class="btn btn-primary" style="margin-top: 15px;">Ajouter un Paiement</a> #}
        </div>
    {% endif %}

</div> {# Fin .page-container #}
{% endblock %}