{% extends "accuiel/base.html" %}

{% block content %}
<div class="container mt-5">

    <h2 class="mb-4 text-center">Créer une Location</h2>

    <!-- Afficher les informations de l'utilisateur -->
    <div class="alert alert-info">
        <p><strong>Utilisateur :</strong> {{ utilisateur.nom }} {{ utilisateur.prenom }}</p>
        <p><strong>Email :</strong> {{ utilisateur.email }}</p>
    </div>

    <!-- Afficher les informations de la chambre -->
    <div class="alert alert-info">
        <p><strong>Type de chambre :</strong> {{ chambre.type_chambre.nom }}</p>
        <p><strong>Prix :</strong> {{ chambre.prix }} CFA</p>
        <p><strong>Surface :</strong> {{ chambre.surface }} m²</p>
    </div>

    <h2 class="mb-4 text-center">Créer une Location</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="mb-3">
            {{ form.utilisateur.label_tag }}
            {{ form.utilisateur }}
        </div>
        <div class="mb-3">
            {{ form.chambre.label_tag }}
            {{ form.chambre }}
        </div>
        <div class="mb-3">
            {{ form.date_debut_location.label_tag }}
            {{ form.date_debut_location }}
        </div>
        <div class="mb-3">
            {{ form.nombre_mois_paye.label_tag }}
            {{ form.nombre_mois_paye }}
        </div>
        <div class="mb-3">
            {{ form.date_fin_avance.label_tag }}
            {{ form.date_fin_avance }}
        </div>
        <div class="mb-3">
            {{ form.montant_avance.label_tag }}
            {{ form.montant_avance }}
        </div>
        <div class="mb-3">
            {{ form.montant_caution.label_tag }}
            {{ form.montant_caution }}
        </div>
        <div class="mb-3">
            {{ form.commission.label_tag }}
            {{ form.commission }}
        </div>
        <div class="mb-3">
            {{ form.montant_total.label_tag }}
            {{ form.montant_total }}
        </div>
        <div class="mb-3">
            {{ form.image_contrat.label_tag }}
            {{ form.image_contrat }}
        </div>
        <div class="mb-3">
            {{ form.statut_paiement.label_tag }}
            {{ form.statut_paiement }}
        </div>
        <div class="mb-3">
            {{ form.mode_paiement.label_tag }}
            {{ form.mode_paiement }}
        </div>
        <div class="mb-3">
            {{ form.date_paiement.label_tag }}
            {{ form.date_paiement }}
        </div>
        <button type="submit" class="btn btn-primary">Enregistrer</button>
    </form>
</div>

<script>
     // Variables pour les informations de la chambre
    const prixChambre = {{ chambre.prix }};
    const tauxCommission = {{ chambre.taux_commission }};
    // Récupérer les champs du formulaire
    const dateDebutInput = document.getElementById("id_date_debut_location");
    const nombreMoisInput = document.getElementById("id_nombre_mois_paye");
    const dateFinInput = document.getElementById("id_date_fin_avance");
    const montantAvanceInput = document.getElementById("id_montant_avance");
    const montantTotalInput = document.getElementById("id_montant_total");
    const commissionInput = document.getElementById("id_commission");

   
    
    // Fonction pour calculer la date de fin
    function calculerDateFin() {
        const dateDebut = new Date(dateDebutInput.value);
        const nombreMois = parseInt(nombreMoisInput.value);

        if (!isNaN(dateDebut.getTime()) && !isNaN(nombreMois)) {
            // Ajouter le nombre de mois à la date de début
            dateDebut.setMonth(dateDebut.getMonth() + nombreMois);
            // Mettre à jour le champ "date_fin_avance"
            dateFinInput.value = dateDebut.toISOString().split("T")[0];
        }
    }

    // Ajouter des écouteurs d'événements pour recalculer la date de fin
    dateDebutInput.addEventListener("change", calculerDateFin);
    nombreMoisInput.addEventListener("input", calculerDateFin);
</script>
{% endblock %}