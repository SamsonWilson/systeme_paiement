{% extends "accuiel/base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h2 class="mb-4 text-center">Créer une Location</h2>

            <!-- Informations de l'utilisateur -->
            <div class="mb-4 card">
                <div class="text-white card-header bg-info">
                    <strong>Informations de l'utilisateur</strong>
                </div>
                <div class="card-body">
                    <p><strong>Nom :</strong> {{ utilisateur.nom }} {{ utilisateur.prenom }}</p>
                    <p><strong>Email :</strong> {{ utilisateur.email }}</p>
                </div>
            </div>

            <!-- Informations de la chambre -->
            <div class="mb-4 card">
                <div class="text-white card-header bg-info">
                    <strong>Informations de la chambre</strong>
                </div>
                <div class="card-body">
                    <p><strong>Type de chambre :</strong> {{ chambre.type_chambre.nom }}</p>
                    <p><strong>Prix :</strong> {{ chambre.prix }} CFA</p>
                    <p><strong>Surface :</strong> {{ chambre.surface }} m²</p>
                    <p><strong>Description :</strong> {{ chambre.description }}</p>
                </div>
            </div>

            <!-- Formulaire de création de location -->
            <div class="card">
                <div class="text-white card-header bg-primary">
                    <strong>Formulaire de location</strong>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="row">
                            <div class="mb-3 col-md-6">
                                {{ form.date_debut_location.label_tag }}
                                {{ form.date_debut_location }}
                            </div>
                            <div class="mb-3 col-md-6">
                                {{ form.nombre_mois_paye.label_tag }}
                                {{ form.nombre_mois_paye }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="mb-3 col-md-6">
                                {{ form.date_fin_avance.label_tag }}
                                {{ form.date_fin_avance }}
                            </div>
                            <div class="mb-3 col-md-6">
                                {{ form.montant_avance.label_tag }}
                                {{ form.montant_avance }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="mb-3 col-md-6">
                                {{ form.montant_caution.label_tag }}
                                {{ form.montant_caution }}
                            </div>
                            <div class="mb-3 col-md-6">
                                {{ form.commission.label_tag }}
                                {{ form.commission }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="mb-3 col-md-6">
                                {{ form.montant_total.label_tag }}
                                {{ form.montant_total }}
                            </div>
                            <div class="mb-3 col-md-6">
                                {{ form.image_contrat.label_tag }}
                                {{ form.image_contrat }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="mb-3 col-md-6">
                                {{ form.statut_paiement.label_tag }}
                                {{ form.statut_paiement }}
                            </div>
                            <div class="mb-3 col-md-6">
                                {{ form.mode_paiement.label_tag }}
                                {{ form.mode_paiement }}
                            </div>
                        </div>
                        <div class="mb-3">
                            {{ form.date_paiement.label_tag }}
                            {{ form.date_paiement }}
                        </div>
                        <button type="submit" class="btn btn-success w-100">Enregistrer</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Récupérer les champs du formulaire
    const dateDebutInput = document.getElementById("id_date_debut_location");
    const nombreMoisInput = document.getElementById("id_nombre_mois_paye");
    const dateFinInput = document.getElementById("id_date_fin_avance");

    // Fonction pour calculer la date de fin
    function calculerDateFin() {
        const dateDebut = new Date(dateDebutInput.value);
        const nombreMois = parseInt(nombreMoisInput.value);

        if (!isNaN(dateDebut.getTime()) && !isNaN(nombreMois)) {
            // Ajouter le nombre de mois à la date de début
            dateDebut.setMonth(dateDebut.getMonth() + nombreMois);
            // Mettre à jour le champ "date_fin_avance"
            dateFinInput.value = dateDebut.toISOString().split("T")[0];
        }
    }

    // Ajouter des écouteurs d'événements pour recalculer la date de fin
    dateDebutInput.addEventListener("change", calculerDateFin);
    nombreMoisInput.addEventListener("input", calculerDateFin);
</script>
{% endblock %}