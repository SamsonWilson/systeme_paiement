{% extends 'accuiel/base.html' %}
{% load static %}

{% block title %}Messagerie{% endblock %}

{% block extra_css %}
<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f1f1f1;
}

.messenger {
    display: flex;
    height: 100vh;
}

.sidebar {
    width: 25%;
    background: #fff;
    border-right: 1px solid #ccc;
    overflow-y: auto;
}

.user-list {
    list-style: none;
    padding: 0;
}

.user {
    padding: 10px;
    display: flex;
    align-items: center;
    cursor: pointer;
}

.user:hover {
    background: #f0f0f0;
}

.user-photo {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 10px;
}

.chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.chat-header {
    padding: 10px;
    background: #4CAF50;
    color: white;
}

.chat-messages {
    flex: 1;
    padding: 10px;
    background: #e5ddd5;
    overflow-y: auto;
}

.chat-message {
    margin-bottom: 10px;
}

#message-form {
    display: flex;
    border-top: 1px solid #ccc;
    background: #fff;
}

#message-input {
    flex: 1;
    padding: 10px;
    border: none;
}

#message-form button {
    padding: 10px;
    background: #4CAF50;
    border: none;
    color: white;
    cursor: pointer;
}
</style>
{% endblock %}

{% block content %}
<div class="messenger">
    <div class="sidebar">
        <h2>Utilisateurs</h2>
        <ul class="user-list">
            {% for user in users %}
            <li class="user" onclick="selectUser({{ user.id }})">
                <img src="{{ user.image.url }}" alt="photo" class="user-photo">
                <span>{{ user.prenom }} {{ user.nom }}</span>
            </li>
            {% endfor %}
        </ul>
    </div>

    <div class="chat-area">
        <div class="chat-header">
            <h3 id="chat-with">Sélectionner un utilisateur</h3>
        </div>

        <div class="chat-messages" id="chat-messages">
            <!-- Messages apparaîtront ici -->
        </div>

        <form id="message-form" onsubmit="sendMessage(event)">
            <input type="text" id="message-input" placeholder="Écrire un message..." autocomplete="off" required>
            <button type="submit">Envoyer</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function selectUser(userId) {
    document.getElementById('chat-with').innerText = "Chat avec l'utilisateur #" + userId;
}

function sendMessage(event) {
    event.preventDefault();
    const messageInput = document.getElementById('message-input');
    const chatMessages = document.getElementById('chat-messages');

    if (messageInput.value.trim() !== '') {
        const newMessage = document.createElement('div');
        newMessage.className = 'chat-message';
        newMessage.innerText = messageInput.value;
        chatMessages.appendChild(newMessage);

        messageInput.value = '';
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
}
</script>
{% endblock %}
